# ─────────────────────────────────────────────
# ALSA Node Policy: disable aggressive suspend, full default volume
#
# Problem 1: WirePlumber suspends ALSA nodes after 5 seconds of idle.
#            This causes audible delays when playback resumes and can
#            interact badly with device hot-plug (suspend/resume cycles).
#
# Problem 2: WirePlumber's default volume for ALSA output devices is
#            0.4^3 ≈ 6.4% on the linear scale (40% on the cubic/perceptual
#            scale, -24 dB). With the virtual sink architecture, this means
#            even at 100% virtual sink volume, the physical output is only
#            at ~40% — speakers sound too quiet.
#
# Policy:  Audio devices stay awake. No pop/click on resume.
#          Physical devices default to full volume so the virtual sink
#          is the single volume control (Windows-like behavior).
#          Audio treated as infrastructure, not battery optimization.
#
# Applies to: WirePlumber 0.5+ (SPA-JSON format)
# Deployed to: ~/.config/wireplumber/wireplumber.conf.d/
# ─────────────────────────────────────────────

wireplumber.settings = {
  # Default volume for newly discovered ALSA output devices.
  # Linear scale: 1.0 = 0 dB = full volume (default: 0.4^3 ≈ 0.064 = -24 dB).
  # With the virtual sink architecture, the user controls volume through the
  # virtual sink. Physical devices should be at max so there's one volume knob.
  device.routes.default-sink-volume = 1.0

  # Default volume for ALSA input devices (microphones).
  # Linear scale: 1.0 = 0 dB = full capture level.
  device.routes.default-source-volume = 1.0
}

monitor.alsa.rules = [
  {
    matches = [
      { node.name = "~alsa_output.*" }
    ]
    actions = {
      update-props = {
        # Disable idle suspension (default: 5 seconds)
        # 0 = never suspend — eliminates audio pops on resume
        session.suspend-timeout-seconds = 0
      }
    }
  }
  {
    matches = [
      { node.name = "~alsa_input.*" }
    ]
    actions = {
      update-props = {
        # Disable idle suspension for inputs too
        session.suspend-timeout-seconds = 0
      }
    }
  }
]

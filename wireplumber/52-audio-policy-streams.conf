# ─────────────────────────────────────────────
# Stream Routing Policy: deterministic, Windows-like behavior
#
# Problem: WirePlumber auto-mutes/corks streams on device hot-plug,
#          and streams get "stuck" on removed devices instead of moving
#          back to the default output.
#
# Policy:  One logical default output. All streams always follow it.
#          Device connect/disconnect = redirect everything automatically.
#          No per-app mute, no lost streams, no manual recovery.
#
# Applies to: WirePlumber 0.5+ (SPA-JSON format)
# Deployed to: ~/.config/wireplumber/wireplumber.conf.d/
# ─────────────────────────────────────────────

wireplumber.settings = {
  # --- Stream movement policy ---

  # Allow WirePlumber to move streams between targets at runtime
  # (required for any automatic redirection to work)
  linking.allow-moving-streams = true

  # When the default sink/source changes, move ALL streams that were on the
  # old default to the new one. This is the core "follow default" behavior.
  linking.follow-default-target = true

  # Do NOT pause (cork) playback streams when their audio sink is removed.
  # Instead, let WirePlumber redirect them to another available sink.
  # Default is true — we disable it to prevent apps from going silent.
  linking.pause-playback = false

  # --- Stream restoration policy ---

  # Do NOT restore a previously stored per-app target device.
  # This prevents streams from "sticking" to a device they were manually
  # assigned to in pavucontrol. ALL streams always use the current default.
  node.stream.restore-target = false

  # DO restore volume and mute state per-stream (convenience, not routing)
  node.stream.restore-props = true

  # Persist default source/sink choice across WirePlumber restarts
  node.restore-default-targets = true

  # --- Device profile restoration ---

  # Restore manually chosen device profiles (e.g. stereo vs surround)
  device.restore-profile = true

  # Restore device routes (volume levels, active ports)
  device.restore-routes = true
}

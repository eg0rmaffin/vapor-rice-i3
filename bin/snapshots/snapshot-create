#!/bin/bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä—É—á–Ω–æ–≥–æ —Å–Ω—ç–ø—à–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã
# Usage: snapshot-create [description]

GREEN="\033[0;32m"
CYAN="\033[0;36m"
RED="\033[0;31m"
RESET="\033[0m"

DESCRIPTION="${1:-Manual snapshot}"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ Snapper
if ! sudo snapper -c root list &>/dev/null; then
    echo -e "${RED}‚ùå Snapper –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ snapshot_setup.sh${RESET}"
    exit 1
fi

echo -e "${CYAN}üì∏ –°–æ–∑–¥–∞–µ–º —Å–Ω—ç–ø—à–æ—Ç: $DESCRIPTION${RESET}"

if sudo snapper -c root create --description "$DESCRIPTION"; then
    echo -e "${GREEN}‚úÖ –°–Ω—ç–ø—à–æ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ${RESET}"
    echo ""
    echo -e "${CYAN}–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–Ω—ç–ø—à–æ—Ç—ã:${RESET}"
    sudo snapper -c root list | tail -5
else
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–Ω—ç–ø—à–æ—Ç–∞${RESET}"
    exit 1
fi

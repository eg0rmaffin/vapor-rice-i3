#!/bin/bash
# List all system snapshots
# Usage: snapshot-list
# Supports: Timeshift (ext4/rsync) and Snapper (Btrfs)

CYAN="\033[0;36m"
YELLOW="\033[1;33m"
RED="\033[0;31m"
RESET="\033[0m"

# Detect which snapshot tool is available
detect_backend() {
    if command -v timeshift &>/dev/null && [ -f /etc/timeshift/timeshift.json ]; then
        echo "timeshift"
    elif command -v snapper &>/dev/null && sudo snapper -c root list &>/dev/null 2>&1; then
        echo "snapper"
    else
        echo "none"
    fi
}

BACKEND=$(detect_backend)

case "$BACKEND" in
    timeshift)
        echo -e "${CYAN}ğŸ“‹ Timeshift snapshots:${RESET}"
        sudo timeshift --list
        ;;
    snapper)
        echo -e "${CYAN}ğŸ“‹ Snapper snapshots:${RESET}"
        sudo snapper -c root list
        ;;
    *)
        echo -e "${RED}âŒ No snapshot tool configured${RESET}"
        echo -e "${YELLOW}Run ~/dotfiles/scripts/snapshot_setup.sh to set up snapshots${RESET}"
        exit 1
        ;;
esac
